<p-toast></p-toast>

<div class="card">
  <p-toolbar styleClass="mb-4">
    <ng-template pTemplate="left">
      <button *ngIf="isAdmin" pButton pRipple label="New" icon="pi pi-plus" class="p-button-success mr-2"
              (click)="showAddEventMetaDialog()"></button>
    </ng-template>
  </p-toolbar>

<p-table [value]="events" dataKey="name">
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 3rem"></th>
            <th>Id</th>
            <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
            <th pSortableColumn="description">Description <p-sortIcon field="description"></p-sortIcon></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-meta let-expanded="expanded">
        <tr>
            <td>
                <button type="button" pButton pRipple [pRowToggler]="meta"
                        class="p-button-text p-button-rounded p-button-plain"
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
            </td>
            <td>{{meta.id}}</td>
            <td>{{meta.name}}</td>
            <td>{{meta.description}}</td>
            </tr>
    </ng-template>
    <ng-template pTemplate="rowexpansion" let-meta>
        <tr>
            <td colspan="7">
                <div class="p-p-3">
                    <p-table [value]="meta.eventList" dataKey="id">
                        <ng-template pTemplate="header">
                            <tr>
                                <th pSortableColumn="hostUser">Host <p-sortIcon field="hostUser"></p-sortIcon></th>
                                <th pSortableColumn="startTime">Start <p-sortIcon field="startTime"></p-sortIcon></th>
                                <th pSortableColumn="endTime">End <p-sortIcon field="endTime"></p-sortIcon></th>
                                <th pSortableColumn="maxAttendeeNr">Limit <p-sortIcon field="maxAttendeeNr"></p-sortIcon></th>
                                <th *ngIf="!isAdmin" style="width: 4rem">Join</th>
                                <th style="width: 3rem">Details</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-event>
                            <tr>
                                <td>{{event.hostUser}}</td>
                                <td>{{event.startTime | date: 'yyyy.MM.dd HH:mm'}}</td>
                                <td>{{event.endTime | date: 'yyyy.MM.dd HH:mm'}}</td>
                                <td>{{event.maxAttendeeNr}}</td>
                                <td *ngIf="!isAdmin">
                                  <button pButton pRipple icon="pi pi-plus" class="p-button-success mr-2"
                                          [disabled]="getRegisteredBoolean(event.id)"
                                          (click)="handlePlus(event.id)"></button>
                                </td>
                                <td>
                                  <button pButton pRipple icon="pi pi-bars" class="p-button-info mr-2 p-button-rounded"
                                          [routerLink]="['/event-details', event.id]"></button>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="6">There is no event added yet.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <ng-container *ngIf="isAdmin">
                    <br>
                    <div style="align-content: center;  justify-content: center;  display: flex;">
                      <button pRipple pButton icon="pi pi-plus" class="p-button-success mr-2 p-button-rounded"
                      [routerLink]="['/event-new', meta.id]"></button>
                    </div>
                   </ng-container>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
</div>

<!--DIALOG FOR ADDING NEW EVENT META-->
<p-dialog [(visible)]="eventMetaCreate && isAdmin" [style]="{width: '450px'}" header="New event-meta"
          [modal]="true" styleClass="p-fluid" [closable]="false" [closeOnEscape]="false">
  <form name="addEventForm"
        #ff="ngForm"
        novalidate>
    <div class="p-field">
      <label for="title">Title</label>
      <input id="title" type="text" pInputText name="title" [(ngModel)]="addEventMetaForm.name"
             class="form-control" required>
      <label for="description">Description</label>
      <textarea pInputTextarea id="description" type="textarea" pInputText name="description"
                [(ngModel)]="addEventMetaForm.description"
                class="form-control" required></textarea>
    </div>
    <br>
    <!-- FOOTER-->
    <div class="row">
      <div class="col">
        <button class="form-control p-button-warning" pButton type="button" label="Cancel"
                icon="pi pi-times" (click)="closeAddEventMeta()"></button>
      </div>
      <div class="col">
        <button class="form-control p-button-success" pButton [disabled]="ff.form.invalid" type="submit"
                label="Save" icon="pi pi-check"
                (click)="addEventMetaButton()"></button>
      </div>
    </div>
  </form>
</p-dialog>
